<VirtualHost *:80>
    ServerName esmassiva.local
    ServerAlias localhost

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/esmassiva-error.log
    CustomLog ${APACHE_LOG_DIR}/esmassiva-access.log combined

    # Tamaño máximo de carga de archivos
    LimitRequestBody 1073741824

    # Proxy hacia la aplicación Node.js (Vinxi)
    ProxyPreserveHost On
    ProxyRequests Off

    # Configuración para WebSockets (HMR en desarrollo)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://127.0.0.1:3000/$1" [P,L]

    # Proxy principal
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/

    # Headers para el proxy
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"

    # Desactivar buffering para SSE y streaming
    SetEnv proxy-sendchunked 1
    SetEnv proxy-sendcl 0
</VirtualHost>

# Configuración HTTPS (opcional, descomenta si tienes certificados SSL)
# <VirtualHost *:443>
#     ServerName esmassiva.local
#
#     SSLEngine on
#     SSLCertificateFile /etc/ssl/certs/esmassiva.crt
#     SSLCertificateKeyFile /etc/ssl/private/esmassiva.key
#
#     ErrorLog ${APACHE_LOG_DIR}/esmassiva-ssl-error.log
#     CustomLog ${APACHE_LOG_DIR}/esmassiva-ssl-access.log combined
#
#     LimitRequestBody 1073741824
#
#     ProxyPreserveHost On
#     ProxyRequests Off
#
#     RewriteEngine On
#     RewriteCond %{HTTP:Upgrade} websocket [NC]
#     RewriteCond %{HTTP:Connection} upgrade [NC]
#     RewriteRule ^/?(.*) "ws://127.0.0.1:3000/$1" [P,L]
#
#     ProxyPass / http://127.0.0.1:3000/
#     ProxyPassReverse / http://127.0.0.1:3000/
#
#     RequestHeader set X-Forwarded-Proto "https"
#     RequestHeader set X-Forwarded-Port "443"
#
#     SetEnv proxy-sendchunked 1
#     SetEnv proxy-sendcl 0
# </VirtualHost>

